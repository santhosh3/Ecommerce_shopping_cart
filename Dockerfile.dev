# syntax=docker/dockerfile:1

# Base image for development
FROM golang:1.22.5 AS dev

# Set the working directory
WORKDIR /src

# Optional: Set the GOPROXY environment variable to bypass proxy issues
ENV GOPROXY=https://proxy.golang.org,direct

# Install Air using an alternative method if go install fails
RUN git clone https://github.com/cosmtrek/air.git /tmp/air \
    && cd /tmp/air \
    && go build -o /go/bin/air

# Copy go.mod and go.sum files
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy the entire source code into the container
COPY . .

# Ensure Air is executable
RUN chmod +x /go/bin/air

# Set Air as the entrypoint
ENTRYPOINT ["air"]

# Expose the development port
EXPOSE 3500
